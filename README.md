# Heart Attack Risk Prediction

## Описание проекта
Проект посвящён анализу открытого датасета с медицинскими показателями пациентов,
построению модели машинного обучения для оценки риска сердечного приступа и 
созданию REST-сервиса на FastAPI для выполнения предсказания последующей интеграции в сервис. 

Задача сформулирована как бинарная классификация с акцентом на выявление пациентов
с потенциально высоким риском.

---

## Используемый подход
В качестве финальной модели была выбрана Random Forest.

Оптимизированные гиперпараметры:
- `n_estimators`: 560  
- `max_depth`: 19  
- `min_samples_leaf`: 6  
- `min_samples_split`: 12  
- `max_features`: `'log2'`

---

## Метрики и интерпретация результатов
- ROC-AUC (CV): **0.588**

Для медицинской задачи приоритетной является метрика **Recall**, поскольку
пропуск пациента с высоким риском сердечного приступа может иметь серьёзные последствия.

Баланс между Precision и Recall подбирался путём максимизации **F2-метрики**,
которая сильнее штрафует за ложноотрицательные предсказания.

- Оптимальный порог классификации: **0.325**
- Recall: **1.0**
- Accuracy: **0.4**

Таким образом, модель гарантированно выявляет пациентов с риском,
принимая осознанный компромисс в виде повышенного числа ложноположительных предсказаний.

### Эксперимент с CatBoost
Была произведена попытка улучшить метрики с помощью модели CatBoost. В итоге мемтрика roc-auc 
незначительно увеличилась на кросс-валидации. Однако, при подборе порога при `recall = 1` 
f2-метрика и accuracy вместе с precision оказались хуже, чем у RandomForest. Таким образом,
CatBoost показала себя хуже.

**ВНИМАНИЕ**
В тетрадке main.ipynb поиск наилучших  параметров CatBoost на случайной сетке занял 
243 (!!!)  минуты. Будьте аккуратны при запуске!

---

## Описание приложения
Приложение реализовано **FastAPI** и и предоставляет HTTP-endpoint для выполнения предсказаний.

Сервис принимает на вход путь к CSV-файлу с тестовой выборкой,выполняет предсказание и возвращает
результат в формате JSON.

## Структура приложения

**main.py** 
Файл main.py содержит точку входа приложения. В приложении реализован POST-endpoint /predict,
который принимает параметр: path — абсолютный путь к CSV-файлу с тестовой выборкой
По умолчанию тестовые данные могут располагаться в папке data.
Ответ сервиса возвращается в формате JSON следующего вида:
```python
{
  "status": true,
  "message": {
    "id": [ ... ],
    "prediction": [ ... ]
  }
}
```
Где: id — идентификаторы пациентов, prediction — предсказанные метки классов модели.

**model.py** 
Файл model.py содержит класс Model, инкапсулирующий логику загрузки модели,
предобработки данных и выполнения предсказаний.

- `__init__ ` - загружает сохранённую модель (.pkl) и JSON-файл с порогом классификации
- `gender` - кодирует признак Gender в числовой формат
- `incomplete` - формирует дополнительный бинарный признак incomplete
- `types` - приводит признаки к корректным типам данных
- `__call__` - выполняет полный цикл предобработки и возвращает результат предсказания

---

## Структура репозитория
```text
.
├── data/
│   ├── heart_train.csv      # обучающая выборка
│   └── heart_test.csv       # тестовая выборка
│
├── fastApiProject/
│   ├── main.py              # FastAPI-приложение
│   └── model.py             # класс модели и предобработка
│
├── model/
│   ├── Heart_Attack_Risk_Model.pkl
│   └── threshold.json
│
├── main.ipynb               # исследовательская тетрадь
├── prediction.csv           # предсказания модели
├── requirements.txt         # зависимости
└── .gitignore
```
---

## Как ознакомиться с исследованием
Для ознакомления с проектом рекомендуется открыть `main.ipynb`,
где представлен полный цикл анализа данных, обучения модели и подбора порога.

--- 

## Как запустить приложение
1. Установить зависимости: `pip install -r requirements.txt`
2. Перейти в директорию приложения: `cd fastApiProject`
3. Запустить сервис: `python main.py`
4. Отправить POST-запрос: `http://localhost:8000/predict?path=/absolute/path/to/heart_test.csv`

В случае успешного выполнения запрос вернет ответ в формате JSON. 

