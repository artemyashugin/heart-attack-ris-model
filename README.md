# Heart Attack Risk Prediction

## Описание проекта
Проект посвящён анализу открытого датасета с медицинскими показателями пациентов,
построению модели машинного обучения для оценки риска сердечного приступа и 
созданию приложения на FastAPI для последующей интеграции в сервис. 

Задача сформулирована как бинарная классификация с акцентом на выявление пациентов
с потенциально высоким риском.

---

## Используемый подход
В качестве финальной модели была выбрана Random Forest.

Оптимизированные гиперпараметры:
- `n_estimators`: 560  
- `max_depth`: 19  
- `min_samples_leaf`: 6  
- `min_samples_split`: 12  
- `max_features`: `'log2'`

---

## Метрики и интерпретация результатов
- ROC-AUC (CV): **0.588**

Для медицинской задачи приоритетной является метрика **Recall**, поскольку
пропуск пациента с высоким риском сердечного приступа может иметь серьёзные последствия.

Баланс между Precision и Recall подбирался путём максимизации **F2-метрики**,
которая сильнее штрафует за ложноотрицательные предсказания.

- Оптимальный порог классификации: **0.325**
- Recall: **1.0**
- Accuracy: **0.4**

Таким образом, модель гарантированно выявляет пациентов с риском,
принимая осознанный компромисс в виде повышенного числа ложноположительных предсказаний.

---
## Описание приложения
Приложение реализовано FastAPIи принимает на вход путь к csv файлу тестовой выборки, выполняет предсказание,
путем POST запроса к сервису, и возвращает ответ в формате JSON.

Файл `main.py` содержит тело приложения. В нем реализован POST - запрос `predict`, который в качестве аргумента
`path` отправляет путь к файлу тестовой выборке. По умолчанию, тестовая выборка находится в папке `data`. 
Запрос возвращает ответ в формате JSON вида статус и сообщение:
{
'status' : ..., 
'message' : ...
},где `message` имеет формат массива из id пациентов и массива предсказаний модели:
{
'id' : [...],
'prediction' : [...]
}

Файл  `model.py` реализован класс Model со следующими методами: 
- метод `__init__ ` - подгружает модель формата pkl и JSON с параметром theshold
- `gender` - кодирует признак 'gender' числовым значением
- `incomplete` - создает новый признак 'incomplete'
- `types` - осуществялет приведение типов данных
- `__call__` - основной метод, который осуществляет предобработку данных, путем вызова всех предыдущих методов,
вызывает модель и осуществляет предсказание, возвращая метки классов.

---

## Структура репозитория
- `data` - папка с датасетами
  - `heart_train.csv` — обучающая выборка
  - `heart_test.csv` — тестовая выборка
- `fastApiProject` - приложение на FastAPI
  - `main.py` - файл проекта
  - `model.py` - класс с моделью
- `model` - модель
  - `Heart_Attack_Risk_Model.pkl` — сохранённая обученная модель
  - `threshold.json` -порог модели
- `.gitignore`
- `main.ipynb` — исследовательская тетрадь с анализом данных и обучением модели
- `prediction.csv` — предсказания модели для тестовой выборки
- `requirements.txt` - зависимости

---

## Как ознакомиться с исследованием
Для ознакомления с проектом рекомендуется открыть `main.ipynb`,
где представлен полный цикл анализа данных, обучения модели и подбора порога.

--- 

## Как запустить приложение

Запустив файл `main.py` в дириктории `fastApiProject`, в комнадной строке подключиться к локальному порту по адресу: 
`http://localost:8000`, далее, обратившись к `predict` отправить в переменную `path` абсолютный путь к csv файлу 
тренировочной выборки: 'http://localost:8000/predict?path=...csv`. В случае успешного выполнения запрос вернет
ответ в формате JSON. 

